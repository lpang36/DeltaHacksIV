<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Inert Title</title>

    <!-- Bootstrap core CSS -->
    <link href="{{ url_for('static',filename='vendor/bootstrap/css/bootstrap.min.css') }}" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href="{{ url_for('static',filename='vendor/font-awesome/css/font-awesome.min.css') }}" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Cabin:700' rel='stylesheet' type='text/css'>
    
    <!-- Custom styles for this template -->
    <link href="{{ url_for('static',filename='css/grayscale.min.css') }}" rel="stylesheet">
    <link rel="stylesheet" href='{{ url_for('static',filename='css/style.css') }}'>
        <!-- Custom scripts for this template -->
  <script src="{{ url_for('static',filename='vendor/jquery/jquery.min.js') }}"></script>
   <!--<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>-->
  <script src="{{ url_for('static',filename='vendor/jquery-easing/jquery.easing.min.js') }}"></script>
  <script src="{{ url_for('static',filename='js/grayscale.min.js') }}"></script>

  </head>

  <body id="page-top">

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
      <div class="container">
        <a class="navbar-brand js-scroll-trigger" href="#page-top">Insert Title</a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          Menu
          <i class="fa fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#map">Map</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#download">Insert something</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#contact">Insert something</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Intro Header -->
    <header class="masthead">
      <div class="intro-body">
        <div class="container">
          <div class="row">
            <div class="col-lg-8 mx-auto">
              <h1 class="brand-heading">Inert Title</h1>
              <p class="intro-text">Get to your location the safe way.
                <br>Created by ...</p>
              <a href="#map" class="btn btn-circle js-scroll-trigger">
                <i class="fa fa-angle-double-down animated"></i>
              </a>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- About Section -->
    <section id="map">
      <div class='notMap' style="width:20%;height:1000px;float:left;">
        <div class='ctrl' style="width:100%;height:50%;">
          <div class="row">
            <select id="mode" name="mode">
              <option value="DRIVING" name="mode">DRIVING</option>
              <option value="WALKING" name="mode">WALKING</option>
              <option value="BICYCLING" name="mode">BICYCLING</option>
            </select>
          </div>
          <div class="row">
            <div class="slidecontainer">
              <input type="range" min="0" max="1000" value="100" id="myRange">
            </div>
          </div>
          <div class="row">
            From: <input type="text" id="from">
          </div>
          <div class="row">
            To: <input type="text" id="to">
          </div>
        </div>
        <div id='dir' style="width:100%;height:50%;"></div>
      </div>
      <div id="googleMap" style="width:80%;height:1000px;float:right"></div>
    </section>





<script>

      // Note: This example requires that you consent to location sharing when
      // prompted by your browser. If you see the error "The Geolocation service
      // failed.", it means you probably did not give permission for the browser to
      // locate you.
      var map;
      var pos, pos2;
      function initMap() {
        map = new google.maps.Map(document.getElementById('googleMap'), {
                    zoom: 12,
          center: {lat: 37.7749, lng: -122.4194}
            });

        // Create the search box and link it to the UI element.
       var input = document.getElementById('from');
       var searchBox = new google.maps.places.SearchBox(input);
       var input2 = document.getElementById('to');
       var searchBox2 = new google.maps.places.SearchBox(input2);
       //map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

       // Bias the SearchBox results towards current map's viewport.
       map.addListener('bounds_changed', function() {
         searchBox.setBounds(map.getBounds());
         searchBox2.setBounds(map.getBounds());
       });

       var markers = [];
       // Listen for the event fired when the user selects a prediction and retrieve
       // more details for that place.
       searchBox.addListener('places_changed', function() {
           if (document.getElementById('from').value==='') {
              if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
             pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            var marker = new google.maps.Marker({position:pos});
            marker.setMap(map);
            map.setCenter(pos);
            marker.addListener('click', function() {

            });
          });
           }
           }
           else {
             var places = searchBox.getPlaces();

             if (places.length == 0) {
               return;
             }

             // Clear out the old markers.
             markers.forEach(function(marker) {
               marker.setMap(null);
             });
             markers = [];

             // For each place, get the icon, name and location.
             var bounds = new google.maps.LatLngBounds();
             places.forEach(function(place) {
               if (!place.geometry) {
                 console.log("Returned place contains no geometry");
                 return;
               }



               // Create a marker for each place.
               markers.push(new google.maps.Marker({
                 map: map,
                 //icon: icon,
                 title: place.name,
                 position: place.geometry.location
               }));


               if (place.geometry.viewport) {
                 // Only geocodes have viewport.
                 bounds.union(place.geometry.viewport);
                  pos = place.geometry.location;
               } else {
                 bounds.extend(place.geometry.location);
                  pos = place.geometry.location;
               }
             });
                                       pos = places[0].geometry.location;
           map.fitBounds(bounds);
           }
           });
           
         searchBox2.addListener('places_changed', function() {
           var places = searchBox2.getPlaces();

           if (places.length == 0) {
             return;
           }

           // Clear out the old markers.
           markers.forEach(function(marker) {
             marker.setMap(null);
           });
           markers = [];

           // For each place, get the icon, name and location.
           var bounds = new google.maps.LatLngBounds();
           places.forEach(function(place) {
             if (!place.geometry) {
               console.log("Returned place contains no geometry");
               return;
             }



             // Create a marker for each place.
             markers.push(new google.maps.Marker({
               map: map,
               //icon: icon,
               title: place.name,
               position: place.geometry.location
             }));


             if (place.geometry.viewport) {
               // Only geocodes have viewport.
               bounds.union(place.geometry.viewport);
                pos2 = place.geometry.location;
             } else {
               bounds.extend(place.geometry.location);
                pos2 = place.geometry.location;
             }
                        pos2 = places[0].geometry.location;
           map.fitBounds(bounds);
           });

           //pass in 2d array of coordinates from python backend, call it coords
           calculateAndDisplayRoute(pos,pos2,pos.lat(),pos.lng(),pos2.lat(),pos2.lng());
         });
             
        /*
        // map.fitBounds(bounds);


         //pass in 2d array of coordinates from python backend, call it coords

         var xmlhttp = new XMLHttpRequest();
         var myArr;
         xmlhttp.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {
            myArr = JSON.parse(this.responseText);
            document.getElementById("demo").innerHTML = myArr[0];
            window.alert(myArr[1]);
          }
        };
        xmlhttp.open("GET", "json_file.txt", true);
        xmlhttp.send();
        calculateAndDisplayRoute(directionsService, directionsDisplay, myArr);
>>>>>>> 079bed039a534e2b86bcea88b5f89253bea65a16:site/index.html
*/


  }

      function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
      }

     function calculateAndDisplayRoute(pos1,pos2,lat1,lng1,lat2,lng2) {
       var xhr = new XMLHttpRequest();
       xhr.open('GET','api/'+lng1+'/'+lat1+'/'+lng2+'/'+lat2+'/'+document.getElementById('myRange').value*0.00001);
       xhr.onload = function(data) {
         coords = JSON.parse(data.currentTarget.response).path
         console.log(coords)
          var waypts = [];
          var otherpts = [];
          var geocoder = new google.maps.Geocoder;
          for (var i = 0; i < coords.length; i++) {
              var curPos = {
               lat: coords[i][1],
               lng: coords[i][0]
             };
            console.log(curPos)
             geocoder.geocode({'location': curPos}, function(results,status) {
                waypts.push(results[0].formatted_address);
                otherpts.push({location: curPos, stopover: true})
             });
          }
          setTimeout(function() {                
            console.log(waypts)
            var directionsService = new google.maps.DirectionsService();
            var directionsDisplay = new google.maps.DirectionsRenderer;
            directionsDisplay.setMap(map)
            console.log($("mode").find("option:selected").val())
            directionsService.route({
              origin: pos1,
              destination: pos2,
              waypoints: otherpts,
              optimizeWaypoints: true,
              travelMode: 'DRIVING'
            }, function(response, status) {
              if (status === 'OK') {
                console.log(response)
                directionsDisplay.setDirections(response);
                var route = response.routes[0];
                var summaryPanel = document.getElementById('dir');
                summaryPanel.innerHTML = '';
                // For each route, display summary information.
                for (var i = 0; i < route.legs.length; i++) {
                  var routeSegment = i + 1;
                  summaryPanel.innerHTML += '<b>Route Segment: ' + routeSegment +
                      '</b><br>';
                  summaryPanel.innerHTML += route.legs[i].start_address + ' to ';
                  summaryPanel.innerHTML += route.legs[i].end_address + '<br>';
                  summaryPanel.innerHTML += route.legs[i].distance.text + '<br><br>';
                }
              } else {
                window.alert('Directions request failed due to ' + status);
              }
            });
             },500);
        }
       xhr.send();
      }
   </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCxDWSD0TwTWvk1sDcCNkcS70JgkS__YQY&libraries=places&callback=initMap">
    </script>
      <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>




  </body>

</html>
